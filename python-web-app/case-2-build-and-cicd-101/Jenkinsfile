// CODE_CHANGES = getGitChanges()

pipeline {
    agent any
    
    
    stages {
         stage('checkout') { 
             steps{
               echo "clone repo..."
               git branch: 'main', url: "https://github.com/DeepCloudmosphere/cloud_POCs.git"
             }

         }
         stage('Build') {
             steps {
                 echo "building...."
                 sh "docker image build -t deepcloudmosphere/python-web:distroless-j ./python-web-app/"
             }

         }
//         stage('test') {
//            steps {
//                 echo "testing...."
//                 sh "docker run  deepcloudmosphere/python-web:distroless-j"
                
//             }

//         }
      
        stage('deploy') {
           steps {
                echo "post to dockerhub"
               withCredentials([
                   usernamePassword(credentialsId: 'dockerhub-credentials', passwordVariable: 'dockerHubPassword', usernameVariable: 'dockerHubUser')
               ]){
                   sh "docker login -u ${dockerHubUser} -p ${dockerHubPassword}""
                   sh "docker push deepcloudmosphere/python-web:distroless-j"
               }
               
            }

        }          
          
    }
    
}

